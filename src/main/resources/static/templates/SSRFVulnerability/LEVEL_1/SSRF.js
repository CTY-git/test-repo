getData();

function setDataInProjectsResponseDiv(data) {
  if (data.isValid) {
    let projectNameAndUrls = JSON.parse(data.content);
    let tableInformation = '<table id="InfoTable">';
    if (projectNameAndUrls.length > 0) {
      for (let key in projectNameAndUrls[0]) {
        tableInformation +=
          '<th class="InfoColumn">' + escapeHTML(key) + "</th>";
      }
    }

    projectNameAndUrls.forEach((projNameAndUrl) => {
      tableInformation +=
        "<tr><td class='InfoColumn'>" +
        escapeHTML(projNameAndUrl.name) +
        "</td><td class='InfoColumn'>" +
        escapeHTML(projNameAndUrl.url) +
        "</td></tr>";
    });
    tableInformation += "</table>";
    document.getElementById("projectsResponse").innerHTML = tableInformation;
  } else {
    document.getElementById("projectsResponse").textContent =
      "Unable to load projects";
  }
}

function getData() {
  let url = getUrlForVulnerabilityLevel();
  doGetAjaxCall(
    setDataInProjectsResponseDiv,
    url +
      "?fileurl=https://gist.githubusercontent.com/raw/bbf2e2183b8f6252061663ce0ddee79b",
    true
  );
}

function escapeHTML(str) {
  return str.replace(/[&<>'"]/g, function (tag) {
    return {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      "'": '&#39;',
      '"': '&quot;'
    }[tag] || tag;
  });
}
